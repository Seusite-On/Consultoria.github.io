<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Assistente de Rejei√ß√µes | Fusion Web</title>

<style>
/* ===== CHAT IA ===== */
#chat-ia {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 320px;
    font-family: Arial, sans-serif;
    z-index: 9999;
}

#chat-header {
    background: #1e40af;
    color: #fff;
    padding: 12px;
    border-radius: 12px 12px 0 0;
    cursor: pointer;
    font-weight: bold;
    text-align: center;
}

#chat-body {
    display: none;
    background: #f9fafb;
    height: 280px;
    overflow-y: auto;
    padding: 10px;
    border-left: 2px solid #1e40af;
    border-right: 2px solid #1e40af;
}

#chat-footer {
    display: none;
    border: 2px solid #1e40af;
    border-top: none;
    border-radius: 0 0 12px 12px;
    background: #fff;
    padding: 8px;
    display: flex;
    gap: 5px;
}

#chat-input {
    flex: 1;
    padding: 8px;
    border-radius: 8px;
    border: 1px solid #ccc;
}

#chat-footer button {
    background: #1e40af;
    color: #fff;
    border: none;
    padding: 8px 12px;
    border-radius: 8px;
    cursor: pointer;
}

.chat-msg {
    margin-bottom: 8px;
    padding: 8px 10px;
    border-radius: 10px;
    font-size: 14px;
}

.bot {
    background: #e0e7ff;
}

.user {
    background: #d1fae5;
    text-align: right;
}
</style>
</head>

<body>

<!-- CHAT -->
<div id="chat-ia">
    <div id="chat-header" onclick="toggleChat()">
        ü§ñ Assistente de Rejei√ß√µes
    </div>

    <div id="chat-body">
        <div class="chat-msg bot">
            Ol√° üëã<br>
            Informe o <b>c√≥digo</b> ou a <b>mensagem da rejei√ß√£o</b> da nota.
        </div>
    </div>

    <div id="chat-footer">
        <input id="chat-input" placeholder="Ex: Rejei√ß√£o 204">
        <button onclick="sendMessage()">‚û§</button>
    </div>
</div>

<script>
/* ===== BASE DE REJEI√á√ïES ===== */
const rejeicoes = {
    "204": {
        titulo: "Rejei√ß√£o 204 ‚Äì Duplicidade de NF-e",
        motivo: "J√° existe uma NF-e autorizada com a mesma chave de acesso.",
        solucao: `
        ‚úî Verifique se a nota j√° foi autorizada<br>
        ‚úî Consulte a NF-e na SEFAZ<br>
        ‚úî Se n√£o existir, inutilize a numera√ß√£o<br>
        üìç Fusion Web: Comercial ‚Üí NF-e ‚Üí Consultar
        `
    },

    "539": {
        titulo: "Rejei√ß√£o 539 ‚Äì Duplicidade de NFC-e",
        motivo: "Cupom fiscal j√° transmitido anteriormente.",
        solucao: `
        ‚úî Verifique se o cupom j√° est√° autorizado<br>
        ‚úî N√£o reenviar o mesmo cupom
        `
    },

    "778": {
        titulo: "Rejei√ß√£o 778 ‚Äì NCM inexistente",
        motivo: "O NCM informado n√£o existe na tabela da SEFAZ.",
        solucao: `
        ‚úî Corrija o NCM no cadastro do produto<br>
        üìç Fusion Web: Estoque ‚Üí Produtos ‚Üí Aba Fiscal
        `
    },

    "610": {
        titulo: "Rejei√ß√£o 610 ‚Äì CFOP inv√°lido",
        motivo: "CFOP informado n√£o √© permitido para a opera√ß√£o.",
        solucao: `
        ‚úî Verifique o tipo de opera√ß√£o (entrada/sa√≠da)<br>
        ‚úî Ajuste o CFOP correto no produto ou na nota
        `
    }
};

/* ===== FUN√á√ïES ===== */
let chatOpen = false;

function toggleChat() {
    chatOpen = !chatOpen;
    document.getElementById("chat-body").style.display = chatOpen ? "block" : "none";
    document.getElementById("chat-footer").style.display = chatOpen ? "flex" : "none";
}

function sendMessage() {
    const input = document.getElementById("chat-input");
    const msg = input.value.trim();
    if (!msg) return;

    addMsg(msg, "user");
    input.value = "";

    setTimeout(() => responder(msg), 500);
}

function addMsg(text, type) {
    const body = document.getElementById("chat-body");
    const div = document.createElement("div");
    div.className = "chat-msg " + type;
    div.innerHTML = text;
    body.appendChild(div);
    body.scrollTop = body.scrollHeight;
}

function responder(texto) {
    texto = texto.toLowerCase();
    const codigo = texto.match(/\d{3}/);

    if (codigo && rejeicoes[codigo[0]]) {
        const r = rejeicoes[codigo[0]];
        addMsg(
            `<b>${r.titulo}</b><br><br>
             <b>üìå Motivo:</b><br>${r.motivo}<br><br>
             <b>‚úÖ Como resolver:</b><br>${r.solucao}`,
            "bot"
        );
        return;
    }

    addMsg(
        "‚ö†Ô∏è Este assistente responde apenas sobre <b>rejei√ß√µes fiscais</b>.<br>" +
        "Informe o c√≥digo da rejei√ß√£o (ex: 204, 610, 778).",
        "bot"
    );
}
</script>

</body>
</html>
